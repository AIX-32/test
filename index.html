<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTC GEN.</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #18141e;
            color: white;
            text-align: center;
        }
#blocklyDiv {
    height: 700px; 
    width: 100%;   
}
        .container {
            max-width: 1200px;
            margin: auto;
        }
        button {
            padding: 10px 15px;
            margin: 10px;
            background: #B68AFF;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background: #A17AE1;
        }
        pre {
            background: #292135;
            padding: 10px;
            border-radius: 5px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>PTC GEN.</h2>
        <div id="blocklyDiv"></div>
        <button onclick="generateScript()">Generate Script</button>
        <h3>Generated PTC</h3>
        <pre id="scriptOutput"></pre>
    </div>

    <xml id="toolbox" style="display: none">
        <category name="Bloxd.io" colour="#B68AFF">
            <block type="set_health"></block>
            <block type="log_message"></block>
            <block type="apply_melee_hit"></block>
            <block type="get_position"></block>
            <block type="get_player_ids"></block>
            <block type="player_is_in_game"></block>
            <block type="player_is_logged_in"></block>
            <block type="get_block_coordinates"></block>
            <block type="get_block_types"></block>
            <block type="apply_health_change"></block>
            <block type="set_shield_amount"></block>
            <block type="get_shield_amount"></block>
            <block type="show_shop_tutorial"></block>
            <block type="apply_melee_hit"></block>
        </category>
    </xml>

    <script>
        let workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox')
        });

        Blockly.defineBlocksWithJsonArray([
            {
                "type": "set_health",
                "message0": "Set health of %1 to %2",
                "args0": [
                    { "type": "input_value", "name": "ENTITY" },
                    { "type": "input_value", "name": "HEALTH" }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": "#B68AFF"
            },
            {
                "type": "log_message",
                "message0": "Log message %1",
                "args0": [
                    { "type": "input_value", "name": "MESSAGE" }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": "#B68AFF"
            },
            {
                "type": "apply_melee_hit",
                "message0": "Melee hit from %1 to %2",
                "args0": [
                    { "type": "input_value", "name": "HITTER" },
                    { "type": "input_value", "name": "TARGET" }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": "#B68AFF"
            },
            {
                "type": "get_position",
                "message0": "Get position of %1",
                "args0": [
                    { "type": "input_value", "name": "ENTITY" }
                ],
                "output": "Array",
                "colour": "#B68AFF"
            },
            {
                "type": "get_player_ids",
                "message0": "Get player IDs",
                "output": "Array",
                "colour": "#B68AFF"
            },
            {
                "type": "player_is_in_game",
                "message0": "Is player %1 in game?",
                "args0": [
                    { "type": "input_value", "name": "PLAYER" }
                ],
                "output": "Boolean",
                "colour": "#B68AFF"
            },
            {
                "type": "player_is_logged_in",
                "message0": "Is player %1 logged in?",
                "args0": [
                    { "type": "input_value", "name": "PLAYER" }
                ],
                "output": "Boolean",
                "colour": "#B68AFF"
            },
            {
                "type": "get_block_coordinates",
                "message0": "Get block coordinates player %1 is standing on",
                "args0": [
                    { "type": "input_value", "name": "PLAYER" }
                ],
                "output": "Array",
                "colour": "#B68AFF"
            },
            {
                "type": "get_block_types",
                "message0": "Get block types player %1 is standing on",
                "args0": [
                    { "type": "input_value", "name": "PLAYER" }
                ],
                "output": "Array",
                "colour": "#B68AFF"
            },
            {
                "type": "apply_health_change",
                "message0": "Apply health change of %1 to %2",
                "args0": [
                    { "type": "input_value", "name": "ENTITY" },
                    { "type": "input_value", "name": "HEALTH_CHANGE" }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": "#B68AFF"
            },
            {
                "type": "set_shield_amount",
                "message0": "Set shield amount of %1 to %2",
                "args0": [
                    { "type": "input_value", "name": "ENTITY" },
                    { "type": "input_value", "name": "SHIELD" }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": "#B68AFF"
            },
            {
                "type": "get_shield_amount",
                "message0": "Get shield amount of %1",
                "args0": [
                    { "type": "input_value", "name": "ENTITY" }
                ],
                "output": "Number",
                "colour": "#B68AFF"
            },
            {
                "type": "show_shop_tutorial",
                "message0": "Show shop tutorial for %1",
                "args0": [
                    { "type": "input_value", "name": "PLAYER" }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": "#B68AFF"
            }

        ]);

function generateScript() {
    let code = "";

    function processBlock(block) {
        if (!block) return ""; 

        let blockCode = "";
        
        if (block.type === "set_health") {
            let entity = Blockly.JavaScript.valueToCode(block, "ENTITY", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            let health = Blockly.JavaScript.valueToCode(block, "HEALTH", Blockly.JavaScript.ORDER_ATOMIC) || '100';
            blockCode += `api.setHealth(${entity}, ${health});\n`;
        } else if (block.type === "log_message") {
            let msg = Blockly.JavaScript.valueToCode(block, "MESSAGE", Blockly.JavaScript.ORDER_ATOMIC) || '"Log"';
            blockCode += `api.log(${msg});\n`;
        } else if (block.type === "apply_melee_hit") {
            let hitter = Blockly.JavaScript.valueToCode(block, "HITTER", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            let target = Blockly.JavaScript.valueToCode(block, "TARGET", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.applyMeleeHit(${hitter}, ${target}, [0, 0, 0]);\n`;
        } else if (block.type === "get_position") {
            let entity = Blockly.JavaScript.valueToCode(block, "ENTITY", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.getPosition(${entity});\n`;
        } else if (block.type === "get_player_ids") {
            blockCode += `api.getPlayerIds();\n`;
        } else if (block.type === "player_is_in_game") {
            let player = Blockly.JavaScript.valueToCode(block, "PLAYER", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.playerIsInGame(${player});\n`;
        } else if (block.type === "player_is_logged_in") {
            let player = Blockly.JavaScript.valueToCode(block, "PLAYER", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.playerIsLoggedIn(${player});\n`;
        } else if (block.type === "get_block_coordinates") {
            let player = Blockly.JavaScript.valueToCode(block, "PLAYER", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.getBlockCoordinatesPlayerStandingOn(${player});\n`;
        } else if (block.type === "get_block_types") {
            let player = Blockly.JavaScript.valueToCode(block, "PLAYER", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.getBlockTypesPlayerStandingOn(${player});\n`;
        } else if (block.type === "apply_health_change") {
            let entity = Blockly.JavaScript.valueToCode(block, "ENTITY", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            let healthChange = Blockly.JavaScript.valueToCode(block, "HEALTH_CHANGE", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.applyHealthChange(${entity}, ${healthChange});\n`;
        } else if (block.type === "set_shield_amount") {
            let entity = Blockly.JavaScript.valueToCode(block, "ENTITY", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            let shield = Blockly.JavaScript.valueToCode(block, "SHIELD", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.setShieldAmount(${entity}, ${shield});\n`;
        } else if (block.type === "get_shield_amount") {
            let entity = Blockly.JavaScript.valueToCode(block, "ENTITY", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.getShieldAmount(${entity});\n`;
        } else if (block.type === "show_shop_tutorial") {
            let player = Blockly.JavaScript.valueToCode(block, "PLAYER", Blockly.JavaScript.ORDER_ATOMIC) || '0';
            blockCode += `api.showShopTutorial(${player});\n`;
        }

       
        let nextBlock = block.getNextBlock();
        return blockCode + processBlock(nextBlock);
    }

  
    let blocks = workspace.getTopBlocks(true);
    blocks.forEach(block => {
        code += processBlock(block);
    });

    document.getElementById("scriptOutput").innerText = code || "No script generated yet.";
}

    </script>
</body>
</html>
